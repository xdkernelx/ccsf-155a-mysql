--------------
/* Nestor Alvarez */

    /* enable warnings! */

use bkorders
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  TASK 00 */ 
select user(), current_date(), version(), @@sql_mode
--------------

*************************** 1. row ***************************
        user(): root@localhost
current_date(): 2016-05-07
     version(): 5.7.11-log
    @@sql_mode: STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
1 row in set (0.02 sec)

--------------
/*  TASK 01 */
Select order_date AS OrderDate, count(order_id) AS NumberOrders, sum(quantity * order_price) AS AmntDue, sum(quantity) AS NumbBooksPurch 
From bkorders.order_headers 
JOIN bkorders.order_details USING (order_id) 
WHERE YEAR(order_date) = 2016 
GROUP BY order_date
--------------

+------------+--------------+----------+----------------+
| OrderDate  | NumberOrders | AmntDue  | NumbBooksPurch |
+------------+--------------+----------+----------------+
| 2016-01-01 |            6 |  1301.25 |             43 |
| 2016-01-02 |            2 |  1290.49 |             51 |
| 2016-01-08 |           14 |  1114.43 |             46 |
| 2016-01-18 |            8 |  1383.90 |             40 |
| 2016-01-20 |            1 |    27.29 |              1 |
| 2016-02-01 |            2 |   177.97 |              3 |
| 2016-02-02 |            3 |  1479.72 |             34 |
| 2016-02-03 |            4 | 12930.75 |            391 |
| 2016-02-04 |            2 |    38.89 |              3 |
| 2016-02-05 |            2 |   928.49 |             51 |
| 2016-02-08 |            6 |  2689.01 |            112 |
| 2016-02-12 |            2 |   114.99 |              3 |
| 2016-02-15 |            1 |    40.49 |              1 |
| 2016-02-19 |            1 |    49.95 |              1 |
| 2016-02-20 |            4 |  8089.60 |            157 |
| 2016-02-21 |            2 |   519.50 |             20 |
| 2016-02-22 |            4 |  3863.49 |            153 |
| 2016-02-28 |            1 |   429.50 |             10 |
| 2016-02-29 |            3 |   182.15 |              7 |
| 2016-03-01 |            1 |   165.00 |             11 |
| 2016-03-02 |            3 |  2107.45 |             45 |
| 2016-03-03 |            1 |  1250.00 |             50 |
| 2016-03-04 |            2 |  2749.50 |            100 |
| 2016-03-05 |            2 |   124.95 |              6 |
| 2016-03-06 |            2 |  1475.60 |             10 |
| 2016-03-08 |            3 |   806.00 |             28 |
| 2016-03-10 |            9 |  4308.40 |            154 |
| 2016-03-14 |            5 |   525.40 |             18 |
| 2016-03-15 |            3 |   242.00 |            101 |
| 2016-03-18 |            4 |  1364.06 |             46 |
| 2016-03-19 |            3 |    96.94 |              3 |
| 2016-03-20 |            4 |   966.68 |             25 |
| 2016-03-21 |            6 |  6096.15 |            157 |
| 2016-03-22 |            9 |  2671.10 |             87 |
| 2016-03-23 |            2 |    59.99 |              2 |
| 2016-03-24 |            1 |    45.00 |              1 |
| 2016-03-25 |            3 |   649.95 |             15 |
| 2016-03-26 |            3 |   287.75 |             14 |
| 2016-03-27 |            5 |  6453.45 |            158 |
| 2016-03-28 |            5 | 22220.38 |            578 |
| 2016-03-29 |            2 |  2500.00 |            100 |
| 2016-03-31 |           11 |  3100.26 |            109 |
| 2016-04-02 |            1 |    58.00 |              1 |
| 2016-04-04 |            3 |   287.75 |             14 |
| 2016-04-07 |            3 |  4394.95 |            110 |
| 2016-04-11 |            2 |   137.45 |              4 |
| 2016-04-12 |            5 |  4123.93 |            105 |
| 2016-05-03 |            5 |  3150.80 |            106 |
| 2016-05-06 |            7 | 21582.15 |            518 |
| 2016-05-11 |            2 |   137.45 |              4 |
| 2016-06-02 |            4 |   513.50 |             16 |
| 2016-06-11 |            2 |   137.45 |              4 |
| 2016-06-28 |            3 |  9742.50 |            250 |
| 2016-06-29 |            2 |  2047.80 |             30 |
| 2016-06-30 |            4 |  5433.30 |            112 |
| 2016-07-15 |            6 |   802.59 |             22 |
| 2016-07-22 |            3 |   308.70 |              7 |
| 2016-07-28 |            3 |  9742.50 |            250 |
| 2016-08-11 |            2 |   137.45 |              4 |
| 2016-08-12 |            2 |   119.95 |              3 |
| 2016-08-13 |            4 |   103.90 |              4 |
+------------+--------------+----------+----------------+
61 rows in set (0.00 sec)

--------------
/*  TASK 02 */
Select (CASE WHEN `Year` IS NULL THEN 'Grand Total' ELSE lpad(`Year`, 11, ' ') END) AS `Year` 
	,  (CASE WHEN `Year` IS NULL THEN '..........' 
			 WHEN `Month` IS NULL THEN 'Year Total' ELSE lpad(`Month`, 10, ' ') END) AS `Month` 
    ,  (CASE WHEN `Year` IS NULL THEN '...........' 
			 WHEN `Month` IS NULL THEN '...........' 
             WHEN ORDER_ID IS NULL THEN 'Month Total' ELSE lpad(ORDER_ID, 11, ' ') END) AS ORDER_ID
	, AmntDue, NumbBooksPurch 
From (
	Select YEAR(order_date) AS `Year`, Month(order_date) AS `Month`, order_id AS ORDER_ID, sum(order_price * quantity) AS AmntDue, sum(quantity) AS NumbBooksPurch 
	From bkorders.order_headers 
	JOIN bkorders.order_details USING (order_id) 
	WHERE order_date BETWEEN '2015-11-01' and '2016-02-29' 
	GROUP BY `Year`, `Month`, order_id WITH ROLLUP	
     ) ROLLED
--------------

+-------------+------------+-------------+----------+----------------+
| Year        | Month      | ORDER_ID    | AmntDue  | NumbBooksPurch |
+-------------+------------+-------------+----------+----------------+
|        2015 |         11 |       15648 |  4745.00 |            150 |
|        2015 |         11 |       18003 |   221.70 |              6 |
|        2015 |         11 |       18013 |    50.90 |              3 |
|        2015 |         11 |       20019 |  1250.00 |             50 |
|        2015 |         11 |       20029 |   219.00 |             20 |
|        2015 |         11 |       20038 |    24.00 |              2 |
|        2015 |         11 |       30816 |  1250.00 |             50 |
|        2015 |         11 |       30820 |  1250.00 |             50 |
|        2015 |         11 |       30821 |    21.90 |              2 |
|        2015 |         11 |       30822 |   499.50 |             10 |
|        2015 |         11 |       30824 |  1300.00 |             30 |
|        2015 |         11 |       30825 |   181.96 |              4 |
|        2015 |         11 |       30826 |   560.00 |             16 |
|        2015 |         11 |       30833 |  1250.00 |             50 |
|        2015 |         11 |       30834 |    49.95 |              1 |
|        2015 |         11 |       30855 |  1000.00 |            500 |
|        2015 |         11 |       51840 |    24.00 |              2 |
|        2015 |         11 |       51841 |  1290.49 |             51 |
|        2015 |         11 |       51842 |   218.69 |             11 |
|        2015 |         11 |       81005 |   170.90 |              6 |
|        2015 |         11 |       81006 |   109.50 |             10 |
|        2015 |         11 |       82897 |  1239.50 |             30 |
|        2015 |         11 |       82898 |   364.92 |             10 |
|        2015 |         11 |       82899 |  2053.90 |             70 |
|        2015 |         11 | Month Total | 19345.81 |           1134 |
|        2015 |         12 |       60002 |    50.90 |              3 |
|        2015 |         12 |       60005 | 21159.00 |            502 |
|        2015 |         12 |       60009 |  9879.95 |            254 |
|        2015 |         12 |       60011 |   195.45 |              5 |
|        2015 |         12 |       60012 |   137.45 |              4 |
|        2015 |         12 |       60018 |   123.95 |              3 |
|        2015 |         12 |       60019 |   564.95 |             12 |
|        2015 |         12 |       60025 |   199.95 |              1 |
|        2015 |         12 |       60027 |  2755.55 |            117 |
|        2015 |         12 |       60029 |   213.14 |              6 |
|        2015 |         12 |       60030 |   199.95 |              1 |
|        2015 |         12 |       60032 |  6948.40 |            168 |
|        2015 |         12 |       60039 |   845.49 |            153 |
|        2015 |         12 | Month Total | 43274.13 |           1229 |
|        2015 | Year Total | ........... | 62619.94 |           2363 |
|        2016 |          1 |        1200 |  1383.90 |             40 |
|        2016 |          1 |       12005 |    27.29 |              1 |
|        2016 |          1 |       31840 |    24.00 |              2 |
|        2016 |          1 |       31841 |  1250.00 |             50 |
|        2016 |          1 |       31850 |    40.49 |              1 |
|        2016 |          1 |       51845 |  1277.25 |             41 |
|        2016 |          1 |       51846 |   642.68 |             32 |
|        2016 |          1 |       51857 |   185.12 |              5 |
|        2016 |          1 |       51858 |   116.70 |              6 |
|        2016 |          1 |       51859 |   113.94 |              2 |
|        2016 |          1 |       51860 |    55.99 |              1 |
|        2016 |          1 | Month Total |  5117.36 |            181 |
|        2016 |          2 |       19224 |   441.52 |              8 |
|        2016 |          2 |       19253 |    69.00 |              3 |
|        2016 |          2 |       31852 |    40.49 |              1 |
|        2016 |          2 |       31853 |   999.00 |             30 |
|        2016 |          2 |       31855 |    40.49 |              1 |
|        2016 |          2 |       31860 |    40.49 |              1 |
|        2016 |          2 |       51847 |    38.89 |              3 |
|        2016 |          2 |       51848 |   888.00 |             50 |
|        2016 |          2 |       51849 |  2138.00 |            100 |
|        2016 |          2 |       51861 |   177.97 |              3 |
|        2016 |          2 |       51862 |   480.72 |              4 |
|        2016 |          2 |       51863 |   837.90 |             42 |
|        2016 |          2 |       51864 | 12092.85 |            349 |
|        2016 |          2 |       91013 |  6794.00 |            149 |
|        2016 |          2 |       91014 |   519.50 |             20 |
|        2016 |          2 |       91307 |   114.99 |              3 |
|        2016 |          2 |       91841 |  3750.00 |            150 |
|        2016 |          2 |       91850 |    55.49 |              2 |
|        2016 |          2 |       92812 |    49.95 |              1 |
|        2016 |          2 |       92905 |    58.00 |              1 |
|        2016 |          2 |       94106 |   429.50 |             10 |
|        2016 |          2 |       94299 |   182.15 |              7 |
|        2016 |          2 |       94802 |  1295.60 |              8 |
|        2016 |          2 | Month Total | 31534.50 |            946 |
|        2016 | Year Total | ........... | 36651.86 |           1127 |
| Grand Total | .......... | ........... | 99271.80 |           3490 |
+-------------+------------+-------------+----------+----------------+
78 rows in set (0.00 sec)

--------------
/*  TASK 03 */
Select (CASE WHEN `Year` IS NULL THEN 'Grand Total' ELSE lpad(`Year`, 11, ' ') END) AS `Year` 
	,  'Yearly Total'  
    ,  NumberOrders 
	, AmntDue, NumbBooksPurch 
From (
	Select YEAR(order_date) AS `Year`, count(order_id) AS NumberOrders, sum(order_price * quantity) AS AmntDue, sum(quantity) AS NumbBooksPurch 
	From bkorders.order_headers 
	JOIN bkorders.order_details USING (order_id) 
	GROUP BY `Year` WITH ROLLUP	
     ) ROLLED
--------------

+-------------+--------------+--------------+-----------+----------------+
| Year        | Yearly Total | NumberOrders | AmntDue   | NumbBooksPurch |
+-------------+--------------+--------------+-----------+----------------+
|        2015 | Yearly Total |          311 | 228054.76 |           7607 |
|        2016 | Yearly Total |          220 | 159879.99 |           4509 |
| Grand Total | Yearly Total |          531 | 387934.75 |          12116 |
+-------------+--------------+--------------+-----------+----------------+
3 rows in set (0.00 sec)

--------------
/*  TASK 04 */
Select (CASE WHEN AuthorID IS NULL THEN 'All Authors' ELSE AuthorID END) AS AuthorID 
,  (CASE WHEN BookID IS NULL THEN 'All Books' ELSE BookID END) AS BookID, TotalQuantity 
,  (CASE WHEN TotalSales IS NULL THEN 'No Sales' ELSE TotalSales END) AS TotalSales 
From (
	Select author_id AS AuthorID, BK.book_id AS BookID, count(order_id) AS TotalQuantity, sum(order_price * quantity) AS TotalSales  
	From bkinfo.books BK 
	JOIN bkinfo.book_authors USING (book_id) 
	LEFT JOIN bkorders.order_details OD ON BK.book_id = OD.book_id 
	WHERE author_sequence = 1 
	GROUP BY author_id, BK.book_id WITH ROLLUP
     ) SALES
--------------

+-------------+-----------+---------------+------------+
| AuthorID    | BookID    | TotalQuantity | TotalSales |
+-------------+-----------+---------------+------------+
| A0110       | 1142      |            29 | 28004.90   |
| A0110       | All Books |            29 | 28004.90   |
| A5748       | 1278      |             1 | 48.00      |
| A5748       | All Books |             1 | 48.00      |
| B1112       | 2006      |             5 | 926.95     |
| B1112       | 2007      |            10 | 1916.98    |
| B1112       | All Books |            15 | 2843.93    |
| B1144       | 1622      |             0 | No Sales   |
| B1144       | All Books |             0 | No Sales   |
| B1244       | 1623      |             0 | No Sales   |
| B1244       | All Books |             0 | No Sales   |
| B2010       | 1102      |             2 | 199.96     |
| B2010       | All Books |             2 | 199.96     |
| C0030       | 1106      |            12 | 3896.50    |
| C0030       | 1107      |            11 | 2387.50    |
| C0030       | 1161      |            20 | 12699.00   |
| C0030       | 1162      |            33 | 6792.76    |
| C0030       | All Books |            76 | 25775.76   |
| C0844       | 1401      |            10 | 34661.00   |
| C0844       | All Books |            10 | 34661.00   |
| C8794       | 1948      |             4 | 491.28     |
| C8794       | All Books |             4 | 491.28     |
| D0030       | 1109      |             6 | 1865.80    |
| D0030       | 1128      |            42 | 64777.59   |
| D0030       | All Books |            48 | 66643.39   |
| D2110       | 1301      |             3 | 2047.50    |
| D2110       | 1304      |             7 | 5491.83    |
| D2110       | All Books |            10 | 7539.33    |
| D3040       | 1101      |            11 | 3871.81    |
| D3040       | All Books |            11 | 3871.81    |
| D6290       | 2025      |             1 | 21840.00   |
| D6290       | All Books |             1 | 21840.00   |
| D8902       | 1182      |             6 | 6683.55    |
| D8902       | All Books |             6 | 6683.55    |
| D8956       | 1175      |             5 | 334.39     |
| D8956       | 1184      |             2 | 299.94     |
| D8956       | All Books |             7 | 634.33     |
| G4748       | 1537      |             6 | 1930.24    |
| G4748       | All Books |             6 | 1930.24    |
| G5050       | 1200      |             6 | 344.30     |
| G5050       | 1234      |             0 | No Sales   |
| G5050       | 1774      |             1 | 14.67      |
| G5050       | All Books |             7 | 358.97     |
| G8495       | 1545      |             2 | 95.80      |
| G8495       | All Books |             2 | 95.80      |
| H0187       | 1457      |             2 | 539.90     |
| H0187       | All Books |             2 | 539.90     |
| H0202       | 1185      |             2 | 299.94     |
| H0202       | All Books |             2 | 299.94     |
| H3145       | 1627      |             4 | 1080.57    |
| H3145       | 1628      |            12 | 1330.55    |
| H3145       | 1629      |            12 | 1516.20    |
| H3145       | All Books |            28 | 3927.32    |
| I5110       | 2031      |             0 | No Sales   |
| I5110       | 2032      |             5 | 233.96     |
| I5110       | All Books |             5 | 233.96     |
| J8845       | 1541      |             3 | 105.90     |
| J8845       | 1542      |             1 | 16.99      |
| J8845       | All Books |             4 | 122.89     |
| K7620       | 1425      |             5 | 2739.68    |
| K7620       | 1448      |            26 | 25749.95   |
| K7620       | 1978      |             3 | 2372.00    |
| K7620       | All Books |            34 | 30861.63   |
| L0140       | 1108      |             2 | 28410.30   |
| L0140       | All Books |             2 | 28410.30   |
| L0453       | 1188      |             2 | 199.96     |
| L0453       | All Books |             2 | 199.96     |
| M0024       | 1609      |             2 | 75.80      |
| M0024       | All Books |             2 | 75.80      |
| M0053       | 1105      |             3 | 4661.95    |
| M0053       | 1110      |             4 | 400.00     |
| M0053       | 1269      |             3 | 186.73     |
| M0053       | All Books |            10 | 5248.68    |
| M0295       | 1543      |             1 | 1250.00    |
| M0295       | 1544      |             2 | 1776.00    |
| M0295       | All Books |             3 | 3026.00    |
| M2475       | 1624      |             0 | No Sales   |
| M2475       | All Books |             0 | No Sales   |
| M3110       | 1302      |             0 | No Sales   |
| M3110       | 1303      |             0 | No Sales   |
| M3110       | All Books |             0 | No Sales   |
| M3145       | 1626      |             1 | 19.95      |
| M3145       | All Books |             1 | 19.95      |
| M3200       | 1546      |             2 | 145.46     |
| M3200       | All Books |             2 | 145.46     |
| M4540       | 2622      |             0 | No Sales   |
| M4540       | 2623      |             0 | No Sales   |
| M4540       | All Books |             0 | No Sales   |
| N6457       | 1835      |             1 | 45.99      |
| N6457       | All Books |             1 | 45.99      |
| P0500       | 1279      |            12 | 472.38     |
| P0500       | All Books |            12 | 472.38     |
| P2308       | 2002      |            29 | 40478.57   |
| P2308       | All Books |            29 | 40478.57   |
| P6030       | 2018      |             1 | 99.98      |
| P6030       | All Books |             1 | 99.98      |
| P7477       | 1525      |             0 | No Sales   |
| P7477       | All Books |             0 | No Sales   |
| R2040       | 1670      |             2 | 2400.00    |
| R2040       | All Books |             2 | 2400.00    |
| R5808       | 1602      |             6 | 2143.50    |
| R5808       | All Books |             6 | 2143.50    |
| R5858       | 1357      |             4 | 2433.60    |
| R5858       | All Books |             4 | 2433.60    |
| S0025       | 1104      |            10 | 5985.00    |
| S0025       | All Books |            10 | 5985.00    |
| S0205       | 2008      |            11 | 4750.45    |
| S0205       | All Books |            11 | 4750.45    |
| S1164       | 1180      |             5 | 606.87     |
| S1164       | All Books |             5 | 606.87     |
| S1900       | 1877      |             2 | 180.00     |
| S1900       | All Books |             2 | 180.00     |
| S2548       | 1677      |             1 | 70.00      |
| S2548       | All Books |             1 | 70.00      |
| S3110       | 1305      |             8 | 5672.00    |
| S3110       | 1306      |             4 | 5002.40    |
| S3110       | All Books |            12 | 10674.40   |
| S5145       | 2009      |            14 | 25682.67   |
| S5145       | All Books |            14 | 25682.67   |
| T6789       | 1979      |             1 | 53.99      |
| T6789       | All Books |             1 | 53.99      |
| V1144       | 1621      |             0 | No Sales   |
| V1144       | All Books |             0 | No Sales   |
| W0030       | 1133      |             4 | 332.10     |
| W0030       | All Books |             4 | 332.10     |
| W0078       | 1258      |            10 | 451.90     |
| W0078       | All Books |            10 | 451.90     |
| W3145       | 1630      |             0 | No Sales   |
| W3145       | All Books |             0 | No Sales   |
| W3433       | 1619      |            11 | 3501.88    |
| W3433       | All Books |            11 | 3501.88    |
| W4512       | 2027      |             0 | No Sales   |
| W4512       | All Books |             0 | No Sales   |
| W5145       | 1625      |             1 | 4.00       |
| W5145       | All Books |             1 | 4.00       |
| All Authors | All Books |           469 | 375101.32  |
+-------------+-----------+---------------+------------+
136 rows in set (0.00 sec)

--------------
/*  TASK 05 */
Select book_id AS Book_ID, page_count AS Page_count, 
	 (
	Select count(distinct BK2.page_count DIV 150) 
    From bkinfo.books BK2 
    WHERE BK2.page_count DIV 150 >= BK1.page_count DIV 150 
		AND BK2.book_id <= 1500
	 ) Rank 
From bkinfo.books BK1 
WHERE book_id NOT IN 
  (
	Select book_id 
    From bkinfo.books 
    WHERE page_count IS NULL
  ) AND book_id <= 1500 
GROUP BY book_id 
ORDER BY Rank, page_count DESC
--------------

+---------+------------+------+
| Book_ID | Page_count | Rank |
+---------+------------+------+
|    1448 |       3192 |    1 |
|    1306 |       2895 |    2 |
|    1401 |        976 |    3 |
|    1182 |        918 |    3 |
|    1142 |        879 |    4 |
|    1269 |        848 |    4 |
|    1161 |        780 |    4 |
|    1108 |        680 |    5 |
|    1184 |        650 |    5 |
|    1109 |        650 |    5 |
|    1104 |        604 |    5 |
|    1185 |        595 |    6 |
|    1175 |        538 |    6 |
|    1110 |        520 |    6 |
|    1258 |        500 |    6 |
|    1200 |        488 |    6 |
|    1245 |        488 |    6 |
|    1425 |        468 |    6 |
|    1105 |        450 |    6 |
|    1234 |        416 |    7 |
|    1278 |        408 |    7 |
|    1077 |        401 |    7 |
|    1180 |        400 |    7 |
|    1162 |        350 |    7 |
|    1279 |        336 |    7 |
|    1107 |        325 |    7 |
|    1304 |        300 |    7 |
|    1101 |        300 |    7 |
|    1457 |        300 |    7 |
|    1128 |        275 |    8 |
|    1102 |        250 |    8 |
|    1106 |        250 |    8 |
|    1357 |        240 |    8 |
|    1133 |        125 |    9 |
|    1103 |        125 |    9 |
|    1483 |        125 |    9 |
|    1188 |        105 |    9 |
|    1305 |        100 |    9 |
|    1199 |         98 |    9 |
|    1301 |          0 |    9 |
+---------+------------+------+
40 rows in set (0.00 sec)

--------------
/*  TASK 06 */
--------------

Query OK, 0 rows affected (0.00 sec)

Bye
